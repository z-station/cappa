# Инструкция по развертке среды разработчика

Есть два способа развернуть приложение на локальном компьютере:
1. Установить все зависимости на локальный компютер вручную. 
Преимущество данного способа заключеается в возможности использовать дебагер кода и отлаживать код программы по шагам.
Недостатком является сложность установки зависимостей. 
2. Запустить приложение в докер-контейнере. Это наиболее простой и рекомендуемый способ.

Приложение является одним из сервисов учебного комплекса. 
Правила взаимодействия сервисов:
- Если сервисы запущены в docker-контейнерах, то они общаются по виртуальной сети docker_localhost по имени контейнеров. 
Например чтобы обратиться из сервиса cappa_app в sandbox-python38 нужно отправлять http-запросы на адрес 
http://sandbox-python38:9001
- Если сервисы запущены без docker-контейнеров, то они общаются напрямую через запросы на localhost.
Например чтобы обратиться из сервиса cappa_app в sandbox-python38 нужно отправлять http-запросы на адрес 
http://localhost:9001
- Если один сервис запущен в docker-контейнере, а второй без него то сервисы **не смогут обратиться друг к другу** т.к http-запросы будут отправляться и слушаться по разным каналам.

### Зависимости:
- Docker >= 19
- Docker Compose >= 1.17  
- Git >= 2.17

**1. Установить зависимости**

**2. Склонировать проект из git-репозитория**

Шаги:
- Настроить глобальный git config [по инструкции](https://git-scm.com/book/ru/v2/%D0%92%D0%B2%D0%B5%D0%B4%D0%B5%D0%BD%D0%B8%D0%B5-%D0%9F%D0%B5%D1%80%D0%B2%D0%BE%D0%BD%D0%B0%D1%87%D0%B0%D0%BB%D1%8C%D0%BD%D0%B0%D1%8F-%D0%BD%D0%B0%D1%81%D1%82%D1%80%D0%BE%D0%B9%D0%BA%D0%B0-Git).
- Зарегистрироваться на [github.com](https://github.com/).
- Сделать форк данного репозитория.
- Склонировать репозиторий.
- Далее все манипуляции будут осуществляться на базе склонированного проекта.

**3. Запуск web-приложения на локальной машине**

Переидти в каталог scripts и выполнить script запуска приложения ``up``
После этого сайт должен стать доступен в браузере по адресу [http://localhost:8999](http://localhost:8999/)

**4. Управление бекапами базы данных**

Все бекапы хранятся в корневой директории backup
В проекте присутствуют встроенные команды для работы с бекапами postgresql

Создание бекапа:
1. Подключиться к docker-контейнеру приложения командой ``` docker exec -it <name> bash```
2. Читай справку по работе с командой ```python manage.py backup_db -h```
3. В общем случае команда для создания бекапа выглядит так: ``` python manage.py backup_db```
4. После этого на родительской машине появится файл бекапа ```backup/<дата>/<дата><время>.sql```, например: ```backup/2022-03-01/2022-03-01-07-33-57.sql```

Восстановление из бекапа:
1. Разместить файл бекапа в директории backup
2. Подключиться к docker-контейнеру приложения командой ``` docker exec -it <name> bash```
3. Читай справку по работе с командой ```python manage.py restore_db -h```
4. В общем случае команда для восстановления из бекапа выглядит так: ``` python manage.py restore_db -f <имя файла>.sql```

#### Процесс совместной работы
- Все доработки делать в новой git-ветке;
- В конце разработки ветка будет слита в основной репозиторий через pull-request.
